#!/usr/bin/env python3
import requests
import re
import json
import sys
from getpass import getpass
from time import sleep
import os

# Clear screen function
def clear_screen():
    os.system('clear' if os.name == 'posix' else 'cls')

# Stylish banner display
def show_banner():
    clear_screen()
    print("\033[1;36m")
    print("  _______  ______   _______  _______  _______  ___   _______  _______ ")
    print(" |       ||      | |       ||       ||       ||   | |       ||       |")
    print(" |    ___||  _    ||    ___||    ___||    ___||   | |_     _||    ___|")
    print(" |   |___ | | |   ||   |___ |   |___ |   |___ |   |   |   |  |   |___ ")
    print(" |    ___|| |_|   ||    ___||    ___||    ___||   |   |   |  |    ___|")
    print(" |   |    |       ||   |___ |   |    |   |___ |   |   |   |  |   |___ ")
    print(" |___|    |______| |_______||___|    |_______||___|   |___|  |_______|")
    print("\033[1;35m")
    print("            Token & Cookie Generator - Termux Version")
    print("                 Created by Zaryab")
    print("\033[1;33m")
    print("-------------------------------------------------------------")
    print("\033[0m")
    sleep(2)

# Main function to get FB token
def get_fb_token(username, password):
    session = requests.Session()
    
    # Set mobile browser headers
    headers = {
        'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Mobile Safari/537.36',
        'Accept-Language': 'en-US,en;q=0.9',
        'Connection': 'keep-alive'
    }
    
    try:
        # Get initial cookies
        response = session.get('https://m.facebook.com/', headers=headers)
        
        # Prepare login data
        login_data = {
            'email': username,
            'pass': password,
            'login': 'Log In'
        }
        
        # Login URL
        login_url = 'https://m.facebook.com/login/device-based/regular/login/?refsrc=deprecated&lwv=100'
        
        # Perform login
        response = session.post(login_url, data=login_data, headers=headers, allow_redirects=True)
        
        # Check login success
        if 'c_user' in session.cookies:
            user_id = session.cookies.get('c_user')
            
            # Get profile name
            profile_response = session.get(f'https://m.facebook.com/profile.php?id={user_id}', headers=headers)
            name_match = re.search(r'<title>(.*?)<\/title>', profile_response.text)
            profile_name = name_match.group(1).split('|')[0].strip() if name_match else "Unknown"
            
            # Get token
            home_page = session.get('https://m.facebook.com/home.php', headers=headers).text
            token_match = re.search(r'\"accessToken\":\"(.*?)\"', home_page)
            
            if token_match:
                access_token = token_match.group(1)
            else:
                # Alternative token method
                response = session.get('https://business.facebook.com/business_locations', headers=headers)
                token_match = re.search(r'\"accessToken\":\"(.*?)\"', response.text)
                access_token = token_match.group(1) if token_match else None
            
            return {
                'status': 'success',
                'cookies': session.cookies.get_dict(),
                'access_token': access_token,
                'profile_name': profile_name,
                'user_id': user_id
            }
        elif 'checkpoint' in response.url:
            return {
                'status': 'checkpoint',
                'message': 'Facebook requires account verification. Please check your account.'
            }
        else:
            return {
                'status': 'failed',
                'message': 'Login failed. Check your credentials.'
            }
    
    except Exception as e:
        return {
            'status': 'error',
            'message': f'An error occurred: {str(e)}'
        }

# Display result in a stylish way
def show_result(result):
    clear_screen()
    if result['status'] == 'success':
        print("\033[1;32m")
        print("  _____                             _ ")
        print(" / ____|                           | |")
        print("| (___  _   _  ___ ___ ___  ___ ___| |")
        print(" \___ \| | | |/ __/ __/ _ \/ __/ __| |")
        print(" ____) | |_| | (_| (_|  __/\__ \__ \_|")
        print("|_____/ \__,_|\___\___\___||___/___(_)")
        print("\033[1;36m")
        print(f"\nWelcome, {result['profile_name']}!")
        print(f"User ID: {result['user_id']}")
        
        print("\n\033[1;35m=== Facebook Cookies ===\033[0m")
        print(json.dumps(result['cookies'], indent=2))
        
        print("\n\033[1;35m=== Access Token ===\033[0m")
        print(result['access_token'])
        
        print("\n\033[1;31mIMPORTANT: Keep this information secure!\033[0m")
        print("\033[1;33mDon't share with anyone as it provides access to your account.\033[0m")
    else:
        print("\033[1;31m")
        print("  _____   _                                  ___ ")
        print(" |  ___| (_)                                / _ \\")
        print(" | |_     _   _ __    _ __    ___  _ __   | | | |")
        print(" |  _|   | | | '_ \  | '_ \  / _ \| '_ \  | | | |")
        print(" | |     | | | | | | | | | ||  __/| | | | | |_| |")
        print(" |_|     |_| |_| |_| |_| |_| \___||_| |_|  \___/")
        print("\033[0m")
        print(f"\nError: {result.get('message', 'Unknown error')}")

# Main function
def main():
    show_banner()
    
    print("\033[1;33m")
    print("DISCLAIMER:")
    print("This tool will help generate Facebook access tokens.")
    print("Your credentials are used only for authentication and are not stored.")
    print("Use at your own risk. The developer is not responsible for any account issues.")
    print("\033[1;31m")
    print("NEVER share your credentials or generated tokens with untrusted parties!")
    print("\033[0m")
    
    confirm = input("\nDo you understand and wish to proceed? (yes/no): ").strip().lower()
    if confirm != 'yes':
        print("Exiting...")
        sys.exit(0)
    
    clear_screen()
    print("\033[1;34m")
    print("  ___ _____ _   _ _____ _   _ _____ ___  ___  ___ _____ ")
    print(" / _ \_   _| | | |  ___| \ | |  __ \|  \/  | / _ \_   _|")
    print("/ /_\ \| | | | | | |__ |  \| | |  \/| .  . |/ /_\ \| |  ")
    print("|  _  || | | | | |  __|| . ` | | __ | |\/| ||  _  || |  ")
    print("| | | || | \ \_/ / |___| |\  | |_\ \| |  | || | | || |  ")
    print("\_| |_/\_/  \___/\____/\_| \_/\____/\_|  |_/\_| |_/\_/  ")
    print("\033[0m")
    
    print("\nPlease enter your Facebook login details:")
    username = input("\nEnter Facebook username/email/phone: ").strip()
    password = getpass("Enter Facebook password: ").strip()
    
    print("\n\033[1;36mGenerating token and cookies... Please wait...\033[0m")
    result = get_fb_token(username, password)
    
    show_result(result)
    
    if result['status'] == 'success':
        save = input("\nDo you want to save these details to a file? (yes/no): ").strip().lower()
        if save == 'yes':
            filename = f"fb_{result['user_id']}_token.txt"
            with open(filename, 'w') as f:
                f.write(f"Profile Name: {result['profile_name']}\n")
                f.write(f"User ID: {result['user_id']}\n\n")
                f.write("Cookies:\n")
                f.write(json.dumps(result['cookies'], indent=2))
                f.write("\n\nAccess Token:\n")
                f.write(result['access_token'])
            print(f"\nDetails saved to {filename}")
    
    print("\n\033[1;35mProcess completed. Exiting...\033[0m")

if __name__ == "__main__":
    main()
